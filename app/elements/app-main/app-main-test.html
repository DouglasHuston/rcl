<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>app-main</title>

  <script src="../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="../../bower_components/polymer/polymer.html">
  <script src="../../bower_components/web-component-tester/browser.js"></script>
  <script src="../../bower_components/test-fixture/test-fixture-mocha.js"></script>
  <link rel="import" href="../../bower_components/test-fixture/test-fixture.html">

  <!-- Step 1: import the element to test -->
  <link rel="import" href="../app-main/app-main.html">

</head>
<body>


  <test-fixture id="app">
    <template>
      <app-main test_mode="true"></app-main>
    </template>
  </test-fixture>

  <script>
    'use strict';
    
    // Silence jshint
//     var assert = assert;
//     var test = test;
//     var setup = setup;
//     var suite = suite;
//     var flush = flush;
//     var fixture = fixture;
//     var teardown = teardown;

    var app;

    suite('app-main', function() {

      setup(function(){
        // Provide a global reference to the app's element
        app = fixture('app');
      });

      test('Title displays', function() {
        app = fixture('app');
        assert.equal(app.$.title.textContent, 'Reformed Churches Locator');
      })

      test('Map displays', function() {
        var el = document.querySelector('app-main');
        var map = el.shadowRoot.querySelector('google-map');
        assert.notEqual(map.style.height, '');
      })
      
      test('Map is sized correctly after loading from non-map URL', function() {
        // TODO: How can I load the app at the #import_a_directory URL first?  That is
        //  necessary to get this test to actually test for the error condition.
        // TODO: This test should fail for now, since it is not working correctly.
        assert.equal(1, 0)
        var el = document.querySelector('app-main');
//         var link = el.shadowRoot.querySelector('#import_a_directory a');
//         link.click();
//         // or just do:
//         el.route = 'import_a_directory';
        // TODO: Will this put the Mocha unit test framework into an infinite loop?
//         location.reload();
//         var link = el.shadowRoot.querySelector('#find_a_church a');
//         link.click();
//         el.route = 'find_a_church';
        var map = el.shadowRoot.querySelector('google-map');
        // The map's height should equal its container's height
        assert.equal(map.style.height, (document.querySelector('body').clientHeight - el.shadowRoot.querySelector('core-toolbar').clientHeight) + 'px');
      })
      
      test('"Import a directory" page displays', function() {
        var el = document.querySelector('app-main');
        var section = el.shadowRoot.querySelector('#import_a_directory_section div');
        assert.equal(section.textContent, 'Import a directory');
      })
      
    });
  </script>

</body>
</html>
